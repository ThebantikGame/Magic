<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –ö–≤–∞–¥—Ä–∞—Ç –°—É–¥—å–±—ã</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0c1445, #1a2a6c, #2a0a4a);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 80% 70%, rgba(255,255,255,0.6), transparent),
                radial-gradient(1.5px 1.5px at 50% 20%, rgba(100,200,255,0.7), transparent),
                radial-gradient(1px 1px at 10% 80%, rgba(255,100,255,0.7), transparent);
            pointer-events: none;
            z-index: -2;
        }

        h1 {
            font-size: 2.2rem;
            margin: 20px 0 15px;
            text-shadow: 0 0 10px #8a2be2, 0 0 20px #4b0082;
            letter-spacing: 1px;
            background: linear-gradient(to right, #e0b0ff, #ff69b4, #00ffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .input-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 600px;
            margin: 15px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .input-label {
            font-size: 14px;
            color: #d8bfd8;
            text-shadow: 0 0 5px rgba(224, 176, 255, 0.7);
        }

        input[type="number"] {
            width: 90px;
            padding: 12px;
            text-align: center;
            border: 2px solid #8a2be2;
            background: rgba(30, 10, 50, 0.6);
            color: white;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #ff69b4;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.8);
            background: rgba(40, 15, 60, 0.8);
            transform: scale(1.05);
        }

        button {
            margin: 10px 0 20px;
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(45deg, #8a2be2, #4b0082, #00ffff);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.7);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
        }

        button:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 6px 25px rgba(255, 105, 180, 0.9);
        }

        button:active {
            transform: scale(0.98);
        }

        .section-title {
            margin: 25px 0 10px;
            font-size: 1.4rem;
            color: #d8bfd8;
            text-shadow: 0 0 8px rgba(224, 176, 255, 0.7);
        }

        .table-container {
            margin: 15px 0;
        }

        table {
            border-collapse: separate;
            border-spacing: 0;
            margin: 0 auto 20px;
            background: rgba(10, 5, 20, 0.7);
            border: 2px solid #8a2be2;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(138, 43, 226, 0.6);
            overflow: hidden;
        }

        td {
            border: 1px solid rgba(138, 43, 226, 0.6);
            padding: 12px;
            width: 80px;
            height: 50px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            background: rgba(30, 15, 50, 0.6);
            transition: all 0.3s ease;
            color: #e0b0ff;
            opacity: 0;
            transform: scale(0.8) rotateX(90deg);
        }

        td.visible {
            opacity: 1;
            transform: scale(1) rotateX(0deg);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8) rotateX(90deg);
            }
            70% {
                transform: scale(1.05) rotateX(-10deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateX(0deg);
            }
        }

        #rawTable td {
            color: #aaf0ff;
        }

        .results-container {
            display: flex;
            gap: 40px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .result-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .result-box {
            width: 80px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            background: rgba(40, 10, 60, 0.8);
            border: 2px solid #ff69b4;
            border-radius: 10px;
            color: #ff69b4;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.6);
            transition: all 0.4s ease;
        }

        .result-label {
            font-size: 15px;
            color: #d8bfd8;
            text-align: center;
            max-width: 180px;
            line-height: 1.4;
            text-shadow: 0 0 5px rgba(224, 176, 255, 0.7);
        }

        .hint {
            margin-top: 20px;
            font-size: 14px;
            color: #b19cd9;
            max-width: 500px;
            line-height: 1.5;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –ö–≤–∞–¥—Ä–∞—Ç –°—É–¥—å–±—ã</h1>

    <div class="input-section">
        <div class="input-group">
            <div class="input-label">–î–µ–Ω—å</div>
            <input type="number" id="day" min="1" max="31" value="11">
        </div>
        <div class="input-group">
            <div class="input-label">–ú–µ—Å—è—Ü</div>
            <input type="number" id="month" min="1" max="12" value="1">
        </div>
        <div class="input-group">
            <div class="input-label">–ì–æ–¥</div>
            <input type="number" id="year" value="2001">
        </div>
    </div>

    <button onclick="calculate()">‚ú® –ë–∞–º –±—É–º –±–∞–±–∞—Ö ‚ú®</button>

    <div class="section-title">‚ú® –ú–∞–≥–∏—á–µ—Å–∫–∏–π –ö–≤–∞–¥—Ä–∞—Ç (–≤—Å–µ —è—á–µ–π–∫–∏ ‚Üí —Å—É–º–º–∞ —Ü–∏—Ñ—Ä)</div>
    <div class="table-container">
        <table id="magicTable">
            <tr><td id="m1A"></td><td id="m1B"></td><td id="m1C"></td><td id="m1D"></td></tr>
            <tr><td id="m2A"></td><td id="m2B"></td><td id="m2C"></td><td id="m2D"></td></tr>
            <tr><td id="m3A"></td><td id="m3B"></td><td id="m3C"></td><td id="m3D"></td></tr>
            <tr><td id="m4A"></td><td id="m4B"></td><td id="m4C"></td><td id="m4D"></td></tr>
        </table>
    </div>

    <div class="section-title">üîç –†–µ–∞–ª—å–Ω—ã–π –ö–≤–∞–¥—Ä–∞—Ç (—Ç–æ–ª—å–∫–æ [1,4] ‚Üí —Å—É–º–º–∞ —Ü–∏—Ñ—Ä)</div>
    <div class="table-container">
        <table id="rawTable">
            <tr><td id="r1A"></td><td id="r1B"></td><td id="r1C"></td><td id="r1D"></td></tr>
            <tr><td id="r2A"></td><td id="r2B"></td><td id="r2C"></td><td id="r2D"></td></tr>
            <tr><td id="r3A"></td><td id="r3B"></td><td id="r3C"></td><td id="r3D"></td></tr>
            <tr><td id="r4A"></td><td id="r4B"></td><td id="r4C"></td><td id="r4D"></td></tr>
        </table>
    </div>

    <div class="results-container">
        <div class="result-block">
            <div class="result-box" id="sBox">S</div>
            <div class="result-label" id="sLabel">–°—É–º–º–∞ 1-–π —Å—Ç—Ä–æ–∫–∏</div>
        </div>
        <div class="result-block">
            <div class="result-box" id="xBox">X</div>
            <div class="result-label" id="xLabel">–û–±—â–∞—è —Å—É–º–º–∞</div>
        </div>
    </div>

    <div class="hint">
        –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è ‚Üí –Ω–∞–∂–º–∏—Ç–µ "–ë–∞–º –±—É–º –±–∞–±–∞—Ö" ‚Üí –∏ —É–∑–Ω–∞–π—Ç–µ —á–∏—Å–ª–∞ —Å–≤–æ–µ–π —Å—É–¥—å–±—ã!
    </div>

    <script>
        function digitSumWithSign(n) {
            if (n === 0) return 0;
            const isNegative = n < 0;
            const s = String(Math.abs(n));
            let sum = 0;
            for (let i = 0; i < s.length; i++) {
                const digit = parseInt(s[i], 10);
                if (i === 0 && isNegative) {
                    sum -= digit;
                } else {
                    sum += digit;
                }
            }
            return sum;
        }

        function calculate() {
            let day = parseInt(document.getElementById('day').value);
            let month = parseInt(document.getElementById('month').value);
            let year = parseInt(document.getElementById('year').value);

            if (isNaN(day) || day < 1 || day > 31) day = 1;
            if (isNaN(month) || month < 1 || month > 12) month = 1;
            if (isNaN(year)) year = 2000;

            // A = –º–µ—Å—è—Ü, B = –¥–µ–Ω—å, Z = –ø–æ–ª–Ω—ã–π –≥–æ–¥, C = –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞
            const A = month;
            const B = day;
            const Z = year;
            const C = Z % 100; // –≤—Å–µ–≥–¥–∞ –¥–≤–µ —Ü–∏—Ñ—Ä—ã: 2000 -> 00, 2001 -> 01

            // D_raw = A + B + Z
            const D_raw = A + B + Z;
            // D = —Å—É–º–º–∞ —Ü–∏—Ñ—Ä D_raw
            const D = digitSumWithSign(D_raw);

            // === –°—Ç—Ä–æ–∏–º –±–∞–∑–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –∏–∑ A, B, C, D ===
            const base = [
                [B, A, C, D],              // —Å—Ç—Ä–æ–∫–∞ 1: B, A, C, D
                [C - 2, D + 2, B - 2, A + 2],
                [D + 1, C + 1, A - 1, B - 1],
                [B + 1, A - 3, D + 3, C - 1]
            ];

            // –ú–∞–≥–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞: –≤—Å–µ —è—á–µ–π–∫–∏ ‚Üí —Å—É–º–º–∞ —Ü–∏—Ñ—Ä
            const magicDisplay = base.map(row => row.map(val => digitSumWithSign(val)));

            // –†–µ–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: –≤—Å–µ —è—á–µ–π–∫–∏ ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–µ —á–∏—Å–ª–∞, –∫—Ä–æ–º–µ [0][3] ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ—ë
            const realDisplay = base.map(row => [...row]);
            realDisplay[0][3] = D; // —ç—Ç–æ —É–∂–µ —Å—É–º–º–∞ —Ü–∏—Ñ—Ä, –Ω–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã ‚Äî –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º D –∫–∞–∫ –µ—Å—Ç—å

            // === –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∞–≤–Ω–∞ ===
            const allCells = [];
            const magicIds = [
                ['m1A', 'm1B', 'm1C', 'm1D'],
                ['m2A', 'm2B', 'm2C', 'm2D'],
                ['m3A', 'm3B', 'm3C', 'm3D'],
                ['m4A', 'm4B', 'm4C', 'm4D']
            ];

            const realIds = [
                ['r1A', 'r1B', 'r1C', 'r1D'],
                ['r2A', 'r2B', 'r2C', 'r2D'],
                ['r3A', 'r3B', 'r3C', 'r3D'],
                ['r4A', 'r4B', 'r4C', 'r4D']
            ];

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —è—á–µ–π–∫–∏ —Å –∏—Ö –¥–∞–Ω–Ω—ã–º–∏
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    allCells.push({
                        magicId: magicIds[i][j],
                        realId: realIds[i][j],
                        magicVal: magicDisplay[i][j],
                        realVal: realDisplay[i][j],
                        row: i,
                        col: j
                    });
                }
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —è—á–µ–µ–∫
            for (let i = allCells.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allCells[i], allCells[j]] = [allCells[j], allCells[i]];
            }

            // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã
            for (let cell of allCells) {
                document.getElementById(cell.magicId).textContent = '';
                document.getElementById(cell.realId).textContent = '';
                document.getElementById(cell.magicId).classList.remove('visible');
                document.getElementById(cell.realId).classList.remove('visible');
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º S –∏ X –≤ –∑–∞–≥–ª—É—à–∫—É
            document.getElementById('sBox').textContent = '?';
            document.getElementById('xBox').textContent = '?';

            // –°–ø–∞–≤–Ω–∏–º —è—á–µ–π–∫–∏ –ø–æ –æ–¥–Ω–æ–π
            let index = 0;
            const interval = setInterval(() => {
                if (index >= allCells.length) {
                    clearInterval(interval);

                    // –ü–æ—Å–ª–µ —Å–ø–∞–≤–Ω–∞ ‚Äî —Å—á–∏—Ç–∞–µ–º S –∏ X
                    const S = base[0].reduce((a, b) => a + b, 0);
                    const X = base.flat().reduce((a, b) => a + b, 0);

                    const sBox = document.getElementById('sBox');
                    sBox.textContent = S;
                    sBox.classList.remove('animate-number');
                    void sBox.offsetWidth;
                    sBox.classList.add('animate-number');

                    const xBox = document.getElementById('xBox');
                    xBox.textContent = X;
                    xBox.classList.remove('animate-number');
                    void xBox.offsetWidth;
                    xBox.classList.add('animate-number');

                    document.getElementById('sLabel').textContent = `–°—É–º–º–∞ 1-–π —Å—Ç—Ä–æ–∫–∏: ${S}`;
                    document.getElementById('xLabel').textContent = `–û–±—â–∞—è —Å—É–º–º–∞: ${X}`;

                    return;
                }

                const cell = allCells[index];
                const magicEl = document.getElementById(cell.magicId);
                const realEl = document.getElementById(cell.realId);

                magicEl.textContent = cell.magicVal;
                realEl.textContent = cell.realVal;

                magicEl.classList.add('visible');
                realEl.classList.add('visible');

                index++;
            }, 150); // –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–ø–∞–≤–Ω–∞–º–∏
        }
    </script>
</body>
</html>

